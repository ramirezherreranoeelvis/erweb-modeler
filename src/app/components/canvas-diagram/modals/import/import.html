<div class="fixed inset-0 bg-black/40 backdrop-blur-sm z-50 flex items-center justify-center p-4">
    <div
        class="bg-white dark:bg-slate-800 rounded-xl shadow-2xl border border-slate-200 dark:border-slate-700 w-full max-w-2xl flex flex-col max-h-[90vh] animate-[fadeIn_0.2s_ease-out]"
    >
        <!-- Header -->
        <div
            class="p-4 border-b border-slate-200 dark:border-slate-700 flex justify-between items-center bg-slate-50 dark:bg-slate-900 rounded-t-xl"
        >
            <div class="flex items-center gap-2 text-slate-800 dark:text-slate-100 font-bold">
                <div
                    class="bg-blue-100 dark:bg-blue-900 p-1.5 rounded text-blue-600 dark:text-blue-300"
                >
                    <!-- FileInput Icon -->
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="20"
                        height="20"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                    >
                        <path d="M4 22h14a2 2 0 0 0 2-2V7.5L14.5 2H6a2 2 0 0 0-2 2v4" />
                        <polyline points="14 2 14 8 20 8" />
                        <path d="M2 15h10" />
                        <path d="m9 18 3-3-3-3" />
                    </svg>
                </div>
                Import SQL
            </div>
            <button
                (click)="close.emit()"
                class="text-slate-400 hover:text-slate-600 dark:hover:text-slate-200"
            >
                <!-- X Icon -->
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="20"
                    height="20"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                >
                    <path d="M18 6 6 18" />
                    <path d="m6 6 12 12" />
                </svg>
            </button>
        </div>

        <!-- Tabs -->
        <div
            class="flex border-b border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900"
        >
            <button
                (click)="activeTab.set('paste')"
                class="flex-1 py-3 text-xs font-bold transition-colors border-b-2"
                [class]="
                    activeTab() === 'paste'
                        ? 'border-blue-500 text-blue-600 dark:text-blue-400 bg-white dark:bg-slate-800'
                        : 'border-transparent text-slate-500 hover:text-slate-700 dark:hover:text-slate-300'
                "
            >
                <div class="flex items-center justify-center gap-2">
                    <span>Paste SQL</span>
                </div>
            </button>
            <button
                (click)="activeTab.set('file')"
                class="flex-1 py-3 text-xs font-bold transition-colors border-b-2"
                [class]="
                    activeTab() === 'file'
                        ? 'border-blue-500 text-blue-600 dark:text-blue-400 bg-white dark:bg-slate-800'
                        : 'border-transparent text-slate-500 hover:text-slate-700 dark:hover:text-slate-300'
                "
            >
                <div class="flex items-center justify-center gap-2">
                    <span>Upload File</span>
                </div>
            </button>
        </div>

        <!-- Body -->
        <div class="p-6 flex-1 flex flex-col gap-4 overflow-hidden">
            <div
                class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded p-3 text-xs text-slate-600 dark:text-slate-300"
            >
                <strong class="block mb-1 text-blue-700 dark:text-blue-300">
                    Target Engine: {{ engineName() }}
                </strong>
                Supports <code>CREATE TABLE</code> with standard syntax. Handles brackets
                <code>[]</code>, backticks <code>\`</code>, double quotes <code>"</code>, and
                <code>GO</code> separators.
            </div>

            @if (activeTab() === 'paste') {
                <textarea
                    class="flex-1 w-full p-4 font-mono text-xs bg-slate-50 dark:bg-slate-950 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none resize-none"
                    placeholder="CREATE TABLE users ( id INT PRIMARY KEY, name VARCHAR(50) );"
                    [ngModel]="sqlContent()"
                    (ngModelChange)="sqlContent.set($event); error.set(null)"
                ></textarea>
            } @else {
                <div
                    class="flex-1 flex flex-col items-center justify-center border-2 border-dashed border-slate-300 dark:border-slate-600 rounded-lg bg-slate-50 dark:bg-slate-900 hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors p-8"
                >
                    <!-- Upload Icon -->
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="48"
                        height="48"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        class="text-slate-300 dark:text-slate-600 mb-4"
                    >
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                        <polyline points="17 8 12 3 7 8" />
                        <line x1="12" x2="12" y1="3" y2="15" />
                    </svg>
                    <p class="text-sm font-bold text-slate-600 dark:text-slate-300 mb-2">
                        Click to upload .sql or .txt file
                    </p>
                    <input
                        type="file"
                        accept=".sql,.txt"
                        #fileInput
                        (change)="handleFileUpload($event)"
                        class="hidden"
                    />
                    <button
                        (click)="fileInput.click()"
                        class="px-4 py-2 bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded text-xs font-bold shadow-sm hover:shadow"
                    >
                        Select File
                    </button>
                    @if (fileName()) {
                        <div class="mt-4 flex items-center gap-2 text-xs text-green-600 font-bold">
                            <!-- Check Icon -->
                            <svg
                                xmlns="http://www.w3.org/2000/svg"
                                width="14"
                                height="14"
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                                stroke-linecap="round"
                                stroke-linejoin="round"
                            >
                                <polyline points="20 6 9 17 4 12" />
                            </svg>
                            {{ fileName() }} loaded
                        </div>
                    }
                </div>
            }

            @if (error()) {
                <div
                    class="flex items-center gap-2 text-xs text-red-600 bg-red-50 dark:bg-red-900/20 p-3 rounded border border-red-200 dark:border-red-800"
                >
                    <!-- Alert Circle -->
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="16"
                        height="16"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                    >
                        <circle cx="12" cy="12" r="10" />
                        <line x1="12" x2="12" y1="8" y2="12" />
                        <line x1="12" x2="12.01" y1="16" y2="16" />
                    </svg>
                    {{ error() }}
                </div>
            }
        </div>

        <!-- Footer -->
        <div
            class="p-4 border-t border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900 rounded-b-xl flex justify-end gap-3"
        >
            <button
                (click)="close.emit()"
                class="px-4 py-2 text-sm font-semibold text-slate-600 dark:text-slate-400 hover:bg-slate-200 dark:hover:bg-slate-700 rounded transition-colors"
            >
                Cancel
            </button>
            <button
                (click)="handleProcess()"
                class="px-4 py-2 text-sm font-bold text-white bg-blue-600 hover:bg-blue-700 rounded shadow-sm transition-colors flex items-center gap-2"
            >
                Process & Import
            </button>
        </div>
    </div>
</div>
