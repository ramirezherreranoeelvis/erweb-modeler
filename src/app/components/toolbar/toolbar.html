<header
    class="relative h-16 border-b flex items-center justify-between px-4 shadow-sm z-60 shrink-0 bg-white/70 dark:bg-slate-900/70 backdrop-blur-md border-slate-200 dark:border-white/10 transition-colors duration-200"
>
    <!-- Left Content -->
    <div class="flex items-center gap-3">
        <button
            (click)="toggleSidebar.emit()"
            class="p-1.5 text-slate-500 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg transition-colors"
        >
            <!-- Menu Icon -->
            <svg
                xmlns="http://www.w3.org/2000/svg"
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
            >
                <line x1="4" x2="20" y1="12" y2="12" />
                <line x1="4" x2="20" y1="6" y2="6" />
                <line x1="4" x2="20" y1="18" y2="18" />
            </svg>
        </button>

        <div
            class="size-8 rounded-lg bg-linear-to-br from-blue-500 to-purple-600 flex items-center justify-center shadow-lg shadow-blue-500/20 shrink-0"
        >
            <span class="material-icons-round text-white text-lg p-1.5 select-none">schema</span>
        </div>

        <div class="hidden sm:block">
            <h1 class="font-bold text-base text-slate-700 dark:text-slate-100 leading-tight">
                ERWeb Modeler
            </h1>
        </div>
    </div>

    <!-- Right Content -->
    <div class="flex items-center gap-2 sm:gap-3">
        <!-- DB Engine Selector -->
        <div
            class="hidden lg:flex items-center gap-2 px-2 py-1 bg-slate-100 dark:bg-slate-800/50 rounded-lg border border-slate-200 dark:border-slate-700/50 max-w-[120px] sm:max-w-none"
        >
            <!-- Server Icon -->
            <svg
                xmlns="http://www.w3.org/2000/svg"
                width="14"
                height="14"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="text-slate-500 dark:text-slate-400 shrink-0"
            >
                <rect width="20" height="8" x="2" y="2" rx="2" ry="2" />
                <rect width="20" height="8" x="2" y="14" rx="2" ry="2" />
                <line x1="6" x2="6.01" y1="6" y2="6" />
                <line x1="6" x2="6.01" y1="18" y2="18" />
            </svg>

            <select
                [value]="dbEngine()"
                (change)="handleEngineChange($event)"
                class="bg-transparent border-none outline-none text-xs font-medium text-slate-700 dark:text-slate-300 focus:ring-0 cursor-pointer py-1 pr-8 pl-1 w-full appearance-none"
            >
                @for (engine of engines; track engine.value) {
                    <option
                        [value]="engine.value"
                        class="bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200"
                    >
                        {{ engine.label }}
                    </option>
                }
            </select>
        </div>

        <!-- View Mode Selector -->
        <div
            class="hidden max-[500px]:hidden sm:flex items-center gap-1 bg-slate-100 dark:bg-slate-800/50 p-1 rounded-lg border border-slate-200 dark:border-slate-700/50"
        >
            <button
                (click)="setViewMode('logical')"
                [class]="
                    viewMode() === 'logical'
                        ? 'bg-white dark:bg-slate-700 text-blue-600 dark:text-blue-300 shadow-sm'
                        : 'text-slate-500 dark:text-slate-400 hover:text-slate-800 dark:hover:text-slate-200'
                "
                class="px-3 sm:px-4 py-1.5 text-xs font-bold rounded transition-all cursor-pointer"
            >
                Logical
            </button>
            <button
                (click)="setViewMode('physical')"
                [class]="
                    viewMode() === 'physical'
                        ? 'bg-white dark:bg-slate-700 text-blue-600 dark:text-blue-300 shadow-sm'
                        : 'text-slate-500 dark:text-slate-400 hover:text-slate-800 dark:hover:text-slate-200'
                "
                class="px-3 sm:px-4 py-1.5 text-xs font-bold rounded transition-all cursor-pointer"
            >
                Physical
            </button>
        </div>

        <div class="h-6 w-px bg-slate-300 dark:bg-slate-700 mx-1 hidden sm:block"></div>

        <!-- Import Button -->
        <button
            (click)="onImportClick.emit()"
            class="flex items-center gap-2 px-3 py-1.5 hover:bg-slate-200 dark:hover:bg-slate-800 text-slate-700 dark:text-slate-200 rounded shadow-sm text-sm font-bold transition-colors border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800"
            title="Import SQL"
        >
            <span class="material-icons-round text-sm">upload</span>
            <span class="hidden md:inline">Import</span>
        </button>

        <!-- Export Button & Menu -->
        <div class="relative">
            <button
                (click)="toggleExportMenu()"
                class="flex items-center gap-2 px-3 py-2.5 bg-slate-800 dark:bg-blue-600 hover:bg-slate-900 dark:hover:bg-blue-700 text-white rounded shadow-md text-xs font-bold transition-colors"
            >
                <!-- Save Icon -->
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="14"
                    height="14"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                >
                    <path
                        d="M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z"
                    />
                    <path d="M17 21v-8H7v8" />
                    <path d="M7 3v5h8" />
                </svg>
                <span class="hidden lg:inline">Export</span>
            </button>

            @if (showExportMenu()) {
                <div class="fixed inset-0 z-10" (click)="showExportMenu.set(false)"></div>
                <div
                    class="absolute right-0 mt-2 w-48 bg-white dark:bg-slate-800 rounded-lg shadow-xl border border-slate-200 dark:border-slate-700 z-20 overflow-hidden animate-in fade-in zoom-in-95 duration-100"
                >
                    <div class="p-2 border-b border-slate-100 dark:border-slate-700">
                        <label
                            class="flex items-center gap-2 p-2 rounded hover:bg-slate-50 dark:hover:bg-slate-700 cursor-pointer select-none"
                        >
                            <div
                                [class]="
                                    includeLayout()
                                        ? 'bg-blue-600 border-blue-600'
                                        : 'border-slate-300 dark:border-slate-500'
                                "
                                class="w-4 h-4 rounded border flex items-center justify-center transition-colors"
                            >
                                @if (includeLayout()) {
                                    <svg
                                        xmlns="http://www.w3.org/2000/svg"
                                        width="10"
                                        height="10"
                                        viewBox="0 0 24 24"
                                        fill="none"
                                        stroke="white"
                                        stroke-width="4"
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                    >
                                        <polyline points="20 6 9 17 4 12" />
                                    </svg>
                                }
                            </div>
                            <input
                                type="checkbox"
                                class="hidden"
                                [ngModel]="includeLayout()"
                                (ngModelChange)="includeLayout.set($event)"
                            />
                            <span class="text-xs text-slate-700 dark:text-slate-200 font-medium"
                                >Include Positions</span
                            >
                        </label>
                    </div>
                    <button
                        (click)="handleExport()"
                        class="w-full text-left px-4 py-3 text-xs font-bold text-blue-600 dark:text-blue-400 hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors"
                    >
                        Download SQL
                    </button>
                </div>
            }
        </div>
    </div>
</header>
